<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>理解Hadoop和MapReduce</title>

    <link rel="stylesheet" href="/theme/css/normalize.css" />
    <link rel="stylesheet" href="/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="/theme/css/style.css" />
    <link rel="stylesheet" href="/theme/css/pygments.css" />	
    <script src="/theme/js/custom.modernizr.js"></script>
    
    <script type= "text/javascript">
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.src = 'https:' == document.location.protocol ? 'https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js' : 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'; 
        s[(window.opera ? "innerHTML" : "text")] =
            "MathJax.Hub.Config({" + 
            "    config: ['MMLorHTML.js']," + 
            "    jax: ['input/TeX','input/MathML','output/HTML-CSS','output/NativeMML']," +
            "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," + 
            "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
            "    tex2jax: { " +
            "        inlineMath: [ ['$','$'] ], " +
            "        displayMath: [ ['$$','$$'] ]," +
            "        processEscapes: true }, " +
            "    'HTML-CSS': { " +
            "        styles: { '.MathJax .mo, .MathJax .mi': {color: 'black ! important'}} " +
            "    } " +
            "}); ";
        (document.body || document.getElementsByTagName('head')[0]).appendChild(s);
    </script>

</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="">Wangdaiwei's San Siro</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
<article>
    <header>
        <h3 class="article-title"><a href="/posts/2014/Jan/25/li-jie-hadoophe-mapreduce/" rel="bookmark"
        title="Permalink to 理解Hadoop和MapReduce">理解Hadoop和MapReduce</a></h3>
        
    <script type= "text/javascript">
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.src = 'https:' == document.location.protocol ? 'https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js' : 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'; 
        s[(window.opera ? "innerHTML" : "text")] =
            "MathJax.Hub.Config({" + 
            "    config: ['MMLorHTML.js']," + 
            "    jax: ['input/TeX','input/MathML','output/HTML-CSS','output/NativeMML']," +
            "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," + 
            "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
            "    tex2jax: { " +
            "        inlineMath: [ ['$','$'] ], " +
            "        displayMath: [ ['$$','$$'] ]," +
            "        processEscapes: true }, " +
            "    'HTML-CSS': { " +
            "        styles: { '.MathJax .mo, .MathJax .mi': {color: 'black ! important'}} " +
            "    } " +
            "}); ";
        (document.body || document.getElementsByTagName('head')[0]).appendChild(s);
    </script>

    </header>

<h6 class="subheader" title="2014-01-25T00:00:00">Sat 25 January 2014
</h6>


    <h2>为什么需要用到Hadoop</h2>
<p>Hadoop是Apache开源基金会下的一个项目，针对处理大数据的特性设计的分布式编程模型工具。Hadoop的核心思想来源于Google的MapReduce和Google File System（GFS）。通俗来讲，就是将处理的问题分为两个子问题，一个负责将问题分割成一个一个小的部分，另一个负责将前一个步骤的每一部分都合并在一起。</p>
<p>最常见的例子就是单词统计。假设我们需要统计一个文档里的单词，最简单的方式就是用一个dictionary或者map来存储一个key-value对。一旦发现一个新的单词，我们就在这个dictionary里面添加一个条目，value设为1。如果这个单词已经存在，那么取出这个key对应的value，将其加1。这种方式对于一个小的文档来说固然合适，但如果我们处理的是一个TB，PB级别的数据呢？如果我们想在1秒钟之内就处理完这些数据？这就需要用到分布式处理了，也就是多台机器同时运算。对于数单词这样一个简单的工作，要解决的就是如何分配任务，每一台机器需要处理文档的哪个部分，以及如何将这些结果整合在一起。有了这样的思想，我们可以给这两个部分的工作分配给两个模块，一个是mapper，一个是reducer。mapper负责把问题分割成很小的一部分，每一部分都会产生一个问题的输出；reducer负责把所有若干个mapper产生的输出汇总，再计算出所需的输出。由于这种模型涉及到的数据量都比较大，而建立在大数据上的数据处理一般来说都相对比较简单，因此将这种模型一般化，使用户只需要关注mapper和reducer的具体实现，而不用考虑异常处理，问题分割等等细节问题，这就是Hadoop需要解决的问题。</p>
<p>但是，并不是所有问题都适合用MapReduce模型解决，比如说PageRank。当问题涉及到图结构的时候，一个很普遍的现象就是活跃节点和不活跃节点差异非常明显。比如说Yahoo网页的PageRank值要计算很多次才能收敛，因为它链接的网页实在是太多了。而小一点的网站可能一下子就收敛了，因为其本身链接的网站并不多，也并没有很高的影响力。而且在图问题中，绝大部分的节点都是不活跃的，也就是说可能整个MapReduce计算一次，只有少数几个节点的值发生了变化，这严重影响到了处理时间。Google针对这个问题提出了Pregel模型，GraphLab就是参考这个模型实现的，相关的论文里面可以看出在PageRank和三角形计数算法上GraphLab完胜基于MapReduce的Hadoop。</p>
<h2>理解Mapper和Reducer</h2>
<p>如果只从输入输出来看，mapper和reducer的输入输出都是一个key-valud对。当然，具体实现来说key和value并不是必须的，比如说统计所有文档的单词数，mapper的输入就可以是key：文件名，value：文件内容，文件名在这里不需要用到。</p>
<p>对于数单词这个问题，mapper需要做的就是把自己负责的那部分文档的单词都统计出来，输出key-value对。这里的key就是单词，value就是1，代表的含义就是在这部分的文档中这个单词出现了1次。当然，也可以在mapper里面就把所有重复的单词都统计一次，汇总之后再设为这个单词key的value。而reducer就会收到mapper的单词key-value对。假如一开始mapper输入的文档内容是这样的：</p>
<div class="highlight"><pre><span class="n">foo</span> <span class="n">other</span> <span class="n">more</span> <span class="n">data</span> <span class="n">foo</span>
</pre></div>


<p>那么mapper的输出就是如下形式：</p>
<div class="highlight"><pre><span class="n">foo</span> <span class="mi">1</span>
<span class="n">other</span> <span class="mi">1</span>
<span class="n">more</span> <span class="mi">1</span>
<span class="n">data</span> <span class="mi">1</span>
<span class="n">foo</span> <span class="mi">1</span>
</pre></div>


<p>此时reducer接收到的输入是按照key排列号的，因此实际上reducer的输入是如下的顺序输入的：</p>
<div class="highlight"><pre><span class="n">data</span> <span class="mi">1</span>
<span class="n">foo</span> <span class="mi">1</span>
<span class="n">foo</span> <span class="mi">1</span>
<span class="n">more</span> <span class="mi">1</span>
<span class="n">other</span> <span class="mi">1</span>
</pre></div>


<p>于是实际上reducer可以这么写，这里用伪代码实现：</p>
<div class="highlight"><pre><span class="n">let</span> <span class="n">reduce</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">=</span> 
    <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">foreach</span> <span class="kt">int</span> <span class="n">i</span> <span class="n">in</span> <span class="n">vals</span><span class="o">:</span>
        <span class="n">sum</span> <span class="o">+=</span> <span class="n">i</span>
    <span class="n">emit</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">sum</span><span class="p">)</span>
</pre></div>


<p>这样得到的最终reducer的输出应该是这样的：</p>
<div class="highlight"><pre><span class="n">data</span> <span class="mi">1</span>
<span class="n">foo</span> <span class="mi">2</span>
<span class="n">more</span> <span class="mi">1</span>
<span class="n">other</span> <span class="mi">1</span>
</pre></div>


<h2>具体实现</h2>
<p>鉴于网上hadoop的教程都比较多，就不在这里写出来了，用Python实现的可以参考<a href="http://www.michael-noll.com/tutorials/writing-an-hadoop-mapreduce-program-in-python/">Writing an Hadoop MapReduce Program in Python</a>，还有用Java实现的例子：<a href="http://www.cnblogs.com/xia520pi/archive/2012/06/04/2534533.html">Hadoop集群（第9期）_MapReduce初级案例</a>。</p>
<p class="subheader">Category: <a href="/category/study.html">Study</a>

    Tagged: 
    <a href="/tag/mapreduce.html">Mapreduce </a>
</p>



    
    <li>
        <a href="/posts/2014/Jan/07/constraint-satisfaction-problem/">
            Constraint Satisfaction Problem
        </a>
    </li>
    <br>
    <li>
        <a href="/posts/2014/Feb/20/sudoku-problem-definition/">
            Sudoku Problem Definition
        </a>
    </li>

</article>
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="/archives.html">Archives</a>
            <li><a href="/tags.html">Tags</a>
        </ul>

		
        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="/category/misc.html">Misc</a></li>
            <li><a href="/category/study.html">Study</a></li>
   
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://getpelican.com/">Pelican</a></li>
            <li><a href="http://python.org/">Python.org</a></li>
        </ul>
		
        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="https://github.com/wangdaiwei">Github</a></li>
            <li><a href="http://www.linkedin.com/pub/daiwei-wang/57/627/750">LinkedIn</a></li>
            <li><a href="https://www.facebook.com/daiwei.wang.52">Facebook</a></li>
            <li><a href="http://weibo.com/u/1998809807">新浪微博</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
                <p>Wangdaiwei's San Siro by wangdaiwei</p>
            </div>
            </div>
    </div>
</footer>